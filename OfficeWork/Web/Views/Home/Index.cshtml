@{
    ViewBag.Title = "Wechat";
}

@section styles{
@Styles.Render("~/bundles/CodeSeven-toastr/css")
@Styles.Render("~/Content/index.min.css")
@Styles.Render("~/bundles/sweetalert/css")
}


@section scripts{
@Scripts.Render("~/bundles/CodeSeven-toastr/js")
@Scripts.Render("~/bundles/sweetalert/js")
    <script type="text/javascript">
    $(function () {

        $.web.get({
            url: "@Url.Content("~/Home/GetCurentUser")",
            async:true
        }, {
            OnSuccess: function(xhr) {
                switch (xhr.Ret.Key)
                {
                    case "success":
                        $("#txt_NickName").text(xhr.Data.UserName);
                        break;
                    case "error":
                        swal("获取用户失败", xhr.Ret.Value, "error");
                        break;

                }
            }
        });


        var $bar = $("#left_bar");
        var _obj_a = {
            "href": "",
            "data-ajax-id": "Loadmainpage",
            "data-ajax-update": "#page-main",
            "data-ajax": "true",
            "data-ajax-success": "UpdatePage",
            "data-href": ""
        };

        $.web.get({ url: "@Url.Content("~/XT/GetIndexMenus")", async: true }, {
            OnSuccess: function (xhr) {
                switch (xhr.Ret.Key) {
                    case "success":
                        $.each(xhr.Data, function (index, item)
                        {
                            if (item.children && item.children.length > 0)
                            {
                                var $el = $("<li>", { "class": "has-sub" + (index==0?" active":"") }),
                                    $ul = $("<ul>", { "class": "sub-menu" }).hide();
                                $.each(item.children, function (i, t) {
                                    $.extend(_obj_a, { href: t.href, "data-href": t.href||"" });

                                    $ul.append($("<li>").append(
                                        $("<a>", _obj_a).text(t.title).prepend($("<i>", { "class": "menuIcon " + t.icon })).click(function () {
                                            $("#header_progress").stop(false, true).animate({ width: "80%" }, 2000, "swing");
                                        })
                                        ));
                                });

                                $bar.append($el.append(
                                        $("<a>", { "href": "javascript:;" }).append($("<b>", { "class": "caret pull-right" })).append($("<i>", { "class": "menuIcon " + item.icon })).append($("<span>").text(item.title)).click(function (e) {
                                            var $parent = $(this).parent();
                                            if ($parent.hasClass('active')) {
                                                $parent.find(">ul").stop(true, false).slideToggle(300);

                                            }
                                            else {
                                                $parent.addClass('active').find(">ul").stop(true, false).slideDown(300).end().siblings('.active').removeClass('active').find(">ul").slideUp(300);
                                            }
                                        })
                                        ).append($ul)
                                    );
                            }
                            else {
                                $.extend(_obj_a, { href: item.href, "data-href": item.href || "" });
                                var $el = $("<li>", { "class": (index == 0 ? " active" : "") }).append(
                                        $("<a>", _obj_a).append($("<i>", { "class": "menuIcon " + item.icon })).append($("<span>").text(item.title)).click(function () {
                                            var $parent = $(this).parent();
                                            if ($parent.hasClass('active')) {
                                                //return false;
                                            }
                                            else {
                                                //if (item.islink && item.href) {}
                                                $("#header_progress").stop(false, true).animate({ width: "80%" }, 2000, "swing");
                                                $parent.addClass('active').find(">ul").stop(true, false).slideDown(300).end().siblings('.active').removeClass('active').find(">ul").slideUp(300);
                                            }
                                        })
                                        );
                                $bar.append($el);
                            }
                        });
                        //$bar.find(">li").eq(0).find(">a").trigger('click');
                        break;

                }
            }
        });

        $("#Signout").click(function () {
            $.web.get("@Url.Content("~/Login/SignOut")",{
                OnSuccess: function () {
                    swal("注销成功","1秒后自动跳转", "success");
                    setTimeout(function () {
                        window.location.replace("@Url.Content("~/Login/Index")");
                    },500);
                }
            });
        });
    });

    //切换页面时候更新
   function UpdatePage()
   {
       UpdateProgressBar();
       UpdateBreadcrumb();
       UpdateMessage();
   }



        //更新进度条
    function UpdateProgressBar() {
        $("#header_progress").stop(false, true).animate({ width: "100%" }, 500, function () {
            $(this).width(0);
        });
    }
    function UpdateBreadcrumb() {
        //更新当前地址

        if (window.curlocation) {
            var $breadcrumb = $("#page-breadcrumb");
            $breadcrumb.empty();
            $.each(window.curlocation, function (_i, _t) {
                switch (typeof _t) {
                    case "string":
                        $breadcrumb.append(
                  (_i == window.curlocation.length - 1 ? $("<li>", { "class": "active" }).text(_t) : $("<li>").append($("<a>", { "href": "javascript:;" }).text(_t)))
                    );
                        break;
                    case "object":
                        $breadcrumb.append(
                  (_i == window.curlocation.length - 1 ? $("<li>", { "class": "active" }).text(_t.title) : $("<li>").append($("<a>", { "href": (_t.href||"javascript:;") }).text(_t.title)))
                    );
                        break;
                }

            });
        }
    }

    //更新消息
    function UpdateMessage()
    {
        toastr.options = {
            "closeButton": true
        };
        toastr.info("您有一条新的消息，请及时查看！");
        var msgcnt = parseInt($("#user_notice .badge").text());
        $("#user_notice .badge").text(++msgcnt);
    }
    </script>
}

<div id="header" class="header navbar navbar-default navbar-fixed-top">
    <!-- begin container-fluid -->
    <div class="container-fluid">
        <!-- begin mobile sidebar expand / collapse button -->
        <div class="navbar-header">
            <a href="javascript:;" id="logo" class="navbar-brand color-white">
                <span class="navbar-logo"></span>
                <i class="fa fa-weixin color-lightred"></i> WeChat
            </a>
            <button type="button" class="navbar-toggle" data-click="sidebar-toggled">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <!-- end mobile sidebar expand / collapse button -->
        <!-- begin header navigation right -->
        <ul class="nav navbar-nav navbar-right visible-sm visible-md visible-lg">
            <li>
                <div class="navbar-form full-width">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="请输入关键字" autocomplete="off" data-provide="typeahead">
                        <span class="input-group-btn">
                            <a role="button" class="btn btn-search btn-info"
                               href="@Url.Content("~/Common/Share_Search")"
                               data-ajax-id="Search"
                               data-ajax-update="#page-main"
                               data-ajax="true"
                               data-ajax-success="UpdatePage">
                                <i class="fa fa-search"></i>
                            </a>
                        </span>
                    </div>
                </div>
            </li>
            <li class="dropdown" id="user_notice">
                <a href="javascript:;" data-toggle="dropdown" class="dropdown-toggle f-s-14 color-white">
                    <i class="fa fa-bell-o"></i>
                    <span class="badge badge-danger">5</span>
                </a>
                <ul class="dropdown-menu media-list pull-right animated fadeInDown">
                    <li class="dropdown-header">5条新的通知</li>
                    <li class="media">
                        <a href="javascript:;">
                            <div class="media-left"><i class="fa fa-bug media-object bg-red"></i></div>
                            <div class="media-body">
                                <h6 class="media-heading">xxxxx</h6>
                                <div class="text-muted f-s-11">3 分钟前</div>
                            </div>
                        </a>
                    </li>
                    <li class="media">
                        <a href="javascript:;">
                            <div class="media-left"><img src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=2428676430,4161488114&fm=116&gp=0.jpg" class="media-object" alt=""></div>
                            <div class="media-body">
                                <h6 class="media-heading">xxxxx</h6>
                                @*<p>具体内容</p>*@
                                <div class="text-muted f-s-11">25 分钟前</div>
                            </div>
                        </a>
                    </li>
                    <li class="media">
                        <a href="javascript:;">
                            <div class="media-left"><img src="https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=1913246915,2422968925&fm=116&gp=0.jpg" class="media-object" alt=""></div>
                            <div class="media-body">
                                <h6 class="media-heading">xxxxx</h6>
                                @*<p>具体内容</p>*@
                                <div class="text-muted f-s-11">35 分钟前</div>
                            </div>
                        </a>
                    </li>
                    <li class="media">
                        <a href="javascript:;">
                            <div class="media-left"><i class="fa fa-plus media-object bg-green"></i></div>
                            <div class="media-body">
                                <h6 class="media-heading">xxxxx</h6>
                                <div class="text-muted f-s-11">1 小时前</div>
                            </div>
                        </a>
                    </li>
                    <li class="media">
                        <a href="javascript:;">
                            <div class="media-left"><i class="fa fa-envelope media-object bg-blue"></i></div>
                            <div class="media-body">
                                <h6 class="media-heading"> xxxx</h6>
                                <div class="text-muted f-s-11">2 小时前</div>
                            </div>
                        </a>
                    </li>
                    <li class="dropdown-footer text-center">
                        <a href="@Url.Content("~/Common/Share_MsgCenter")"
                           data-ajax-id="MsgCenter"
                           data-ajax-update="#page-main"
                           data-ajax="true"
                           data-ajax-success="UpdatePage">查看更多</a>
                    </li>
                </ul>
            </li>
            <li class="dropdown navbar-user">
                <a href="javascript:;" class="dropdown-toggle color-white" data-toggle="dropdown">
                    <i class="fa fa-user"></i>
                    <span class="hidden-xs" id="txt_NickName">加载中..</span> <b class="caret"></b>
                </a>
                <ul class="dropdown-menu animated fadeInLeft">
                    <li class="arrow"></li>
                    <li><a href="javascript:;"><i class="fa fa-user"></i>个人信息</a></li>
                    <li><a href="javascript:;"><i class="fa fa-cog"></i> 设置</a></li>
                    <li class="divider"></li>
                    <li id="Signout"><a href="javascript:;"><i class="fa fa-sign-out"></i>注销</a></li>
                </ul>
            </li>
        </ul>
        <!-- end header navigation right -->
    </div>
    <!-- end container-fluid -->
</div>
<hr id="header_progress" />
<div class="container-fluid page-center">
    <div id="left_bar_box"><ul class="nav" id="left_bar"></ul></div>
    <ol class="breadcrumb bg-default nomargin" id="page-breadcrumb">
        <li class="active">首页</li>
    </ol>
    <div class="content" id="page-main">
        @{Html.RenderAction("Home", "Home", null);}
    </div>
</div>