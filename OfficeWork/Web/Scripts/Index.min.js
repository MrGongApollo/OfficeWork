$(function () { $.web.getAsync(document.weburl + "Home/GetCurentUser").done(function (e) { switch (e.Ret.Key) { case "success": $("#txt_NickName").text(e.Data.UserName); break; case "error": swal("获取用户失败", e.Ret.Value, "error"); break } }); var e = $("#left_bar"); var a = { href: "", "data-ajax-id": "Loadmainpage", "data-ajax-update": "#page-main", "data-ajax": "true", "data-ajax-success": "UpdatePage", "data-ajax-failure": "fnAjaxError", "data-href": "" }; $.web.getAsync(document.weburl + "XT/GetIndexMenus").done(function (t) { switch (t.Ret.Key) { case "success": $.each(t.Data, function (t, n) { if (n.children && n.children.length > 0) { var s = $("<li>", { class: "has-sub" + (t == 0 ? " active" : "") }), i = $("<ul>", { class: "sub-menu" }).hide(); $.each(n.children, function (e, t) { $.extend(a, { href: document.weburl + t.href, "data-href": t.href ? document.weburl + t.href : "" }); i.append($("<li>").append($("<a>", a).append($("<i>", { class: "menuIcon " + t.icon })).append($("<span>").text(t.title)).click(function () { $("#header_progress").stop(false, true).animate({ width: "80%" }, 2e3, "swing") }))) }); e.append(s.append($("<a>", { href: "javascript:;" }).append($("<b>", { class: "caret pull-right" })).append($("<i>", { class: "menuIcon " + n.icon })).append($("<span>").text(n.title)).click(function (e) { var a = $(this).parent(); if (a.hasClass("active")) { a.find(">ul").stop(true, false).slideToggle(300) } else { a.addClass("active").find(">ul").stop(true, false).slideDown(300).end().siblings(".active").removeClass("active").find(">ul").slideUp(300) } })).append(i)) } else { $.extend(a, { href: document.weburl + n.href, "data-href": n.href ? document.weburl + n.href : "" }); var s = $("<li>", { class: t == 0 ? " active" : "" }).append($("<a>", a).append($("<i>", { class: "menuIcon " + n.icon })).append($("<span>").text(n.title)).click(function () { var e = $(this).parent(); if (e.hasClass("active")) { } else { $("#header_progress").stop(false, true).animate({ width: "80%" }, 2e3, "swing"); e.addClass("active").find(">ul").stop(true, false).slideDown(300).end().siblings(".active").removeClass("active").find(">ul").slideUp(300) } })); e.append(s) } }); break } }); $("#Signout").click(function () { swal({ title: "确认注销当前用户", text: "注销后自动跳转登录界面", type: "warning", showCancelButton: true, confirmButtonColor: "#DD6B55", confirmButtonText: "是", cancelButtonText: "否", closeOnConfirm: false }, function () { $.web.get(document.weburl + "Login/SignOut").done(function () { swal("注销成功", "1秒后自动跳转", "success"); setTimeout(function () { window.location.replace(document.weburl + "Login/Index") }, 500) }) }) }) }); function UpdatePage(e, a, t) { UpdateProgressBar(); UpdateBreadcrumb(); UpdateMessage() } function UpdateProgressBar() { $("#header_progress").stop(false, true).animate({ width: "100%" }, 500, function () { $(this).width(0) }) } function UpdateBreadcrumb() { if (window.curlocation) { var e = $("#page-breadcrumb"); e.empty(); $.each(window.curlocation, function (a, t) { switch (typeof t) { case "string": e.append(a == window.curlocation.length - 1 ? $("<li>", { class: "active" }).text(t) : $("<li>").append($("<a>", { href: "javascript:;" }).text(t))); break; case "object": e.append(a == window.curlocation.length - 1 ? $("<li>", { class: "active" }).text(t.title) : $("<li>").append($("<a>", { href: t.href || "javascript:;" }).text(t.title))); break } }) } } function UpdateMessage() { toastr.options = { closeButton: true, positionClass: "toast-bottom-right" }; toastr.info("您有一条新的消息，请及时查看！"); var e = parseInt($("#user_notice .badge").text()); $("#user_notice .badge").text(++e) } function fnAjaxError(e, a, t) { if (e.status == 908) { swal("用户当前身份过期", "1秒后自动跳转", "error"); window.location.replace(document.weburl + "Login/Index") } else { swal("操作失败", t || "未知错误", "error") } }