$(function () { $.web.get({ url: document.weburl + "Home/GetCurentUser", async: true }, { OnSuccess: function (c) { switch (c.Ret.Key) { case "success": $("#txt_NickName").text(c.Data.UserName); break; case "error": swal("获取用户失败", c.Ret.Value, "error"); break } } }); var b = $("#left_bar"); var a = { href: "", "data-ajax-id": "Loadmainpage", "data-ajax-update": "#page-main", "data-ajax": "true", "data-ajax-success": "UpdatePage", "data-href": "" }; $.web.get({ url: document.weburl + "XT/GetIndexMenus", async: true }, { OnSuccess: function (c) { switch (c.Ret.Key) { case "success": $.each(c.Data, function (e, g) { if (g.children && g.children.length > 0) { var f = $("<li>", { "class": "has-sub" + (e == 0 ? " active" : "") }), d = $("<ul>", { "class": "sub-menu" }).hide(); $.each(g.children, function (j, h) { $.extend(a, { href: h.href, "data-href": h.href || "" }); d.append($("<li>").append($("<a>", a).text(h.title).prepend($("<i>", { "class": "menuIcon " + h.icon })).click(function () { $("#header_progress").stop(false, true).animate({ width: "80%" }, 2000, "swing") }))) }); b.append(f.append($("<a>", { href: "javascript:;" }).append($("<b>", { "class": "caret pull-right" })).append($("<i>", { "class": "menuIcon " + g.icon })).append($("<span>").text(g.title)).click(function (i) { var h = $(this).parent(); if (h.hasClass("active")) { h.find(">ul").stop(true, false).slideToggle(300) } else { h.addClass("active").find(">ul").stop(true, false).slideDown(300).end().siblings(".active").removeClass("active").find(">ul").slideUp(300) } })).append(d)) } else { $.extend(a, { href: g.href, "data-href": g.href || "" }); var f = $("<li>", { "class": (e == 0 ? " active" : "") }).append($("<a>", a).append($("<i>", { "class": "menuIcon " + g.icon })).append($("<span>").text(g.title)).click(function () { var h = $(this).parent(); if (h.hasClass("active")) { } else { $("#header_progress").stop(false, true).animate({ width: "80%" }, 2000, "swing"); h.addClass("active").find(">ul").stop(true, false).slideDown(300).end().siblings(".active").removeClass("active").find(">ul").slideUp(300) } })); b.append(f) } }); break } } }); $("#Signout").click(function () { swal({ title: "确认注销当前用户", text: "注销后自动跳转登录界面", type: "warning", showCancelButton: true, confirmButtonColor: "#DD6B55", confirmButtonText: "是", cancelButtonText: "否", closeOnConfirm: false }, function () { $.web.get(document.weburl + "Login/SignOut", { OnSuccess: function () { swal("注销成功", "1秒后自动跳转", "success"); setTimeout(function () { window.location.replace(document.weburl + "Login/Index") }, 500) } }) }) }) }); function UpdatePage() { UpdateProgressBar(); UpdateBreadcrumb(); UpdateMessage() } function UpdateProgressBar() { $("#header_progress").stop(false, true).animate({ width: "100%" }, 500, function () { $(this).width(0) }) } function UpdateBreadcrumb() { if (window.curlocation) { var a = $("#page-breadcrumb"); a.empty(); $.each(window.curlocation, function (c, b) { switch (typeof b) { case "string": a.append((c == window.curlocation.length - 1 ? $("<li>", { "class": "active" }).text(b) : $("<li>").append($("<a>", { href: "javascript:;" }).text(b)))); break; case "object": a.append((c == window.curlocation.length - 1 ? $("<li>", { "class": "active" }).text(b.title) : $("<li>").append($("<a>", { href: (b.href || "javascript:;") }).text(b.title)))); break } }) } } function UpdateMessage() { toastr.options = { closeButton: true, positionClass: "toast-bottom-right", }; toastr.info("您有一条新的消息，请及时查看！"); var a = parseInt($("#user_notice .badge").text()); $("#user_notice .badge").text(++a) };